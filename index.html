<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mi Dinero · App</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* ===== Diseño minimalista, mobile-first (con soporte desktop) ===== */
    :root{
      --bg: #f7f7f8;         /* fondo claro minimal */
      --card: #ffffff;       /* tarjetas blancas */
      --ink: #0f172a;        /* texto principal */
      --muted: #64748b;      /* texto secundario */
      --line: #e5e7eb;       /* líneas sutiles */
      --accent: #0ea5e9;     /* azul elegante */
      --good: #16a34a;       /* verde */
      --danger: #ef4444;     /* rojo */
      --radius: 14px;
      --shadow: 0 8px 26px rgba(2,6,23,0.06);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b0f14; --card:#0f141b; --ink:#e5e7eb; --muted:#97a3b6; --line:#1f2937; --accent:#38bdf8;
      }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:var(--bg); color:var(--ink)}

    /* Contenedor de vistas como app */
    .app{display:flex; flex-direction:column; min-height:100dvh}
    .app-header{padding:14px 16px; position:sticky; top:0; z-index:5; background:var(--bg); border-bottom:1px solid var(--line)}
    .app-main{flex:1; padding:14px 16px 80px}
    .app-nav{position:fixed; bottom:0; left:0; right:0; background:var(--card); border-top:1px solid var(--line); display:grid; grid-template-columns: repeat(5, 1fr); gap:4px; padding:8px; box-shadow: var(--shadow)}

    /* Header */
    .brand{display:flex; align-items:baseline; justify-content:space-between; gap:12px}
    .title{font-weight:700; font-size:16px}
    .total{font-weight:700; font-size:20px}
    .subtle{color:var(--muted); font-size:12px}

    /* Vistas */
    .view{display:none}
    .view.active{display:block}

    /* Tarjetas minimal */
    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:14px; margin-bottom:12px}
    .card h2{font-size:14px; margin:0 0 8px 0}

    .kpi{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .kpi .label{color:var(--muted); font-size:12px}
    .kpi .value{font-weight:700; font-size:22px}

    .row{display:flex; gap:10px; align-items:center}
    .row.wrap{flex-wrap:wrap}
    .row > * {flex:1}

    input, select, button{
      font:inherit; border-radius:12px; border:1px solid var(--line); background:#fff; color:#0f172a; padding:10px 12px; outline:none
    }
    @media (prefers-color-scheme: dark){ input, select{ background:#0b0f14; color:var(--ink); } }
    button{background:var(--ink); color:#fff; border-color:transparent; cursor:pointer}
    .ghost{background:transparent; color:var(--ink); border-color:var(--line)}
    .accent{background:var(--accent); color:#00223a}

    .grid-2{display:grid; grid-template-columns:1fr; gap:12px}
    @media(min-width:900px){ .grid-2{grid-template-columns:repeat(2, 1fr)} }

    .mini{font-size:11px; color:var(--muted)}
    .muted{color:var(--muted)}

    table{width:100%; border-collapse:collapse; font-size:13px}
    th,td{padding:10px; border-bottom:1px solid var(--line); text-align:right}
    th:first-child, td:first-child{text-align:left}
    .scroll{overflow:auto}

    .nav-btn{display:flex; flex-direction:column; align-items:center; gap:4px; padding:8px 6px; border-radius:10px; border:1px solid transparent; color:var(--muted); background:transparent}
    .nav-btn.active{color:var(--ink); border-color:var(--line); background:var(--bg)}

    /* Desktop: centra y limita ancho */
    .desktop{max-width:1100px; margin:0 auto}
  </style>
</head>
<body>
  <div class="app">
    <!-- ===== Header con saldo total ===== -->
    <header class="app-header">
      <div class="brand desktop">
        <div>
          <div class="title">Mi Dinero</div>
          <div class="subtle">Gestión y proyección — minimal</div>
        </div>
        <div>
          <div class="subtle">Saldo Total</div>
          <div class="total" id="total-balance">—</div>
        </div>
      </div>
    </header>

    <!-- ===== Contenido principal (vistas) ===== -->
    <main class="app-main desktop">
      <!-- DASHBOARD -->
      <section id="view-dashboard" class="view active">
        <div class="grid-2">
          <div class="card">
            <h2>Cuentas</h2>
            <div class="kpi">
              <div>
                <div class="label">Cuenta Corriente</div>
                <div class="value" id="cc-balance">—</div>
              </div>
              <div class="row" style="flex:0 0 auto; gap:6px">
                <input type="number" step="0.01" id="cc-edit" placeholder="Saldo" style="width:120px">
                <button class="ghost" id="cc-apply">Fijar</button>
              </div>
            </div>
            <div class="kpi" style="margin-top:8px">
              <div>
                <div class="label">Cuenta Remunerada</div>
                <div class="value" id="rem-balance">—</div>
              </div>
              <div class="row" style="flex:0 0 auto; gap:6px">
                <input type="number" step="0.01" id="rem-edit" placeholder="Saldo" style="width:120px">
                <button class="ghost" id="rem-apply">Fijar</button>
              </div>
            </div>
          </div>

          <div class="card" id="interest-card" style="cursor:pointer">
            <h2>Rendimiento estimado <span class="mini">(toca para alternar)</span></h2>
            <div class="kpi">
              <div>
                <div class="label" id="interest-mode-label">Mensual</div>
                <div class="value" id="kpi-interest">—</div>
              </div>
              <div>
                <div class="label">Tipo anual</div>
                <div class="value" id="rate-label">—</div>
              </div>
            </div>
            <div class="mini" style="margin-top:6px">Cálculo compuesto mensual para el anual.</div>
            <div class="row" style="margin-top:10px">
              <button id="add-monthly-interest" class="accent">Registrar interés de este mes</button>
              <button id="go-transfer" class="ghost">Transferir</button>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Accesos rápidos</h2>
          <div class="row wrap">
            <button id="go-movements" class="ghost">Añadir ingreso/gasto</button>
            <button id="btn-export" class="ghost">Exportar</button>
            <button id="btn-import" class="ghost">Importar</button>
          </div>
        </div>
      </section>

      <!-- MOVIMIENTOS -->
      <section id="view-movements" class="view">
        <div class="card">
          <h2>Nuevo movimiento</h2>
          <div class="row wrap">
            <input type="date" id="tx-date"/>
            <select id="tx-type"><option value="income">Ingreso</option><option value="expense">Gasto</option></select>
            <select id="tx-account"><option value="checking">Corriente</option><option value="remunerated">Remunerada</option></select>
            <input type="number" step="0.01" id="tx-amount" placeholder="Importe (€)">
          </div>
          <div class="row wrap" style="margin-top:8px">
            <input type="text" id="tx-note" placeholder="Descripción (opcional)">
            <select id="tx-planned"><option value="false">Real</option><option value="true">Planificado</option></select>
            <button id="tx-add">Añadir</button>
          </div>
        </div>
        <div class="card">
          <h2>Movimientos recientes</h2>
          <div class="scroll" style="max-height:50dvh">
            <table id="tx-table">
              <thead><tr><th>Fecha</th><th>Tipo</th><th>Cuenta</th><th>Importe</th><th>Nota</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- TRANSFERIR -->
      <section id="view-transfer" class="view">
        <div class="card">
          <h2>Transferir (simulado)</h2>
          <div class="row wrap">
            <select id="t-from"><option value="checking">Corriente</option><option value="remunerated">Remunerada</option></select>
            <span class="muted" style="flex:0 0 auto">→</span>
            <select id="t-to"><option value="remunerated">Remunerada</option><option value="checking">Corriente</option></select>
            <input type="number" step="0.01" id="t-amount" placeholder="Importe (€)">
            <button id="t-do" class="accent">Transferir</button>
          </div>
          <div class="mini" style="margin-top:6px">Afecta a saldos, no a un banco real.</div>
        </div>
      </section>

      <!-- PROYECCIÓN -->
      <section id="view-projection" class="view">
        <div class="card">
          <h2>Proyección</h2>
          <canvas id="chart" height="80"></canvas>
        </div>
        <div class="card">
          <h2>Detalle</h2>
          <div class="scroll" style="max-height:50dvh">
            <table id="proj-table">
              <thead>
                <tr><th>Mes</th><th>Saldo inicial</th><th>Interés</th><th>Ingresos planif.</th><th>Gastos planif.</th><th>Saldo final</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- AJUSTES -->
      <section id="view-settings" class="view">
        <div class="card">
          <h2>Parámetros</h2>
          <div class="row wrap">
            <div class="row" style="flex:1">
              <input type="number" id="rate" min="0" max="100" step="0.01" placeholder="% TIN anual"/>
              <button id="save-rate" class="ghost">Guardar</button>
            </div>
            <div style="flex:1">
              <div class="mini">Horizonte proyección (meses): <span id="horizon-label">12</span></div>
              <input type="range" id="horizon" min="3" max="36" step="1" value="12" style="width:100%"/>
            </div>
          </div>
        </div>
        <div class="mini">TAE aproximada por capitalización mensual: (1 + TIN/12)^12 - 1</div>
      </section>
    </main>

    <!-- ===== Navegación inferior ===== -->
    <nav class="app-nav">
      <button class="nav-btn active" data-view="dashboard">🏠<span class="mini">Inicio</span></button>
      <button class="nav-btn" data-view="movements">🧾<span class="mini">Movs</span></button>
      <button class="nav-btn" data-view="transfer">🔄<span class="mini">Transferir</span></button>
      <button class="nav-btn" data-view="projection">🔮<span class="mini">Proyección</span></button>
      <button class="nav-btn" data-view="settings">⚙️<span class="mini">Ajustes</span></button>
    </nav>
  </div>

  <!-- === Firebase EXACTO como indicas === -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
  <script>
    // === Firebase Config ===
    const firebaseConfig = {
      apiKey: "AIzaSyDv2Egv82HhG0WT5iXTMKdQQrFOzxx4REk",
      authDomain: "jana-eb892.firebaseapp.com",
      projectId: "jana-eb892",
      storageBucket: "jana-eb892.firebasestorage.app",
      messagingSenderId: "64652708371",
      appId: "1:64652708371:web:30eb4b4e44bba82ac8cde6",
      measurementId: "G-MFFZ0FJ87W"
    };

    // === Init ===
    firebase.initializeApp(firebaseConfig);
    try { firebase.firestore().enablePersistence({ synchronizeTabs: true }); } catch(e){ console.warn('Persistence no disponible:', e.message); }
    window.db = firebase.firestore();
  </script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <script>
    // ===== Utilidades =====
    const fmtEUR = new Intl.NumberFormat('es-ES', { style:'currency', currency:'EUR' });
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
    const todayISO = () => new Date().toISOString().slice(0,10);

    function toast(msg){
      // minimal: usa alert en esta versión para simplicidad
      console.log(msg);
    }

    // ===== Storage (Firestore con fallback) =====
    const storage = {
      async get(path){
        try{ const doc = await db.doc(path).get(); return doc.exists ? doc.data() : null; }
        catch(e){ const raw = localStorage.getItem('LS:'+path); return raw? JSON.parse(raw): null; }
      },
      async set(path, data){
        try{ await db.doc(path).set(data, {merge:true}); }
        catch(e){ localStorage.setItem('LS:'+path, JSON.stringify(data)); }
      },
      async add(col, data){
        try{ await db.collection(col).add(data); }
        catch(e){ const k='LS_ADD:'+col; const arr=JSON.parse(localStorage.getItem(k)||'[]'); arr.push({...data, __localId:Date.now()}); localStorage.setItem(k, JSON.stringify(arr)); }
      },
      async list(col, {limit=100, orderBy='date', desc=true}={}){
        try{ let ref = db.collection(col); if(orderBy) ref = ref.orderBy(orderBy, desc?'desc':'asc'); if(limit) ref = ref.limit(limit); const snap = await ref.get(); return snap.docs.map(d=>({id:d.id, ...d.data()})); }
        catch(e){ const k='LS_ADD:'+col; const arr=JSON.parse(localStorage.getItem(k)||'[]'); arr.sort((a,b)=> (b[orderBy]||0)-(a[orderBy]||0)); return arr.slice(0,limit); }
      }
    }

    // ===== Estado =====
    const state = {
      annualRate: 0.0202,
      horizon: 12,
      accounts: { checking: 1000, remunerated: 10000 },
      transactions: [],
      chart: null,
      interestMode: 'monthly', // 'monthly' | 'annual'
    }

    const paths = { settings:'settings/general', accChecking:'accounts/checking', accRem:'accounts/remunerated', txCol:'transactions' }

    // ===== Carga inicial =====
    async function loadAll(){
      const [settings, accC, accR] = await Promise.all([
        storage.get(paths.settings), storage.get(paths.accChecking), storage.get(paths.accRem)
      ]);
      if(settings?.annualRate!=null) state.annualRate = Number(settings.annualRate);
      if(settings?.horizon) state.horizon = Number(settings.horizon);
      if(accC?.balance!=null) state.accounts.checking = Number(accC.balance);
      if(accR?.balance!=null) state.accounts.remunerated = Number(accR.balance);
      await storage.set(paths.settings, {annualRate:state.annualRate, horizon:state.horizon, updatedAt:Date.now()});
      await storage.set(paths.accChecking, {balance:state.accounts.checking, updatedAt:Date.now()});
      await storage.set(paths.accRem, {balance:state.accounts.remunerated, updatedAt:Date.now()});
      state.transactions = await storage.list(paths.txCol, {limit:200, orderBy:'date', desc:true});
      renderAll();
    }

    // ===== Render =====
    function renderAll(){
      // Totales y saldos
      $('#cc-balance').textContent = fmtEUR.format(state.accounts.checking);
      $('#rem-balance').textContent = fmtEUR.format(state.accounts.remunerated);
      $('#total-balance').textContent = fmtEUR.format(state.accounts.checking + state.accounts.remunerated);

      // Etiquetas
      $('#rate').value = (state.annualRate*100).toFixed(2);
      $('#rate-label').textContent = (state.annualRate*100).toFixed(2) + '%';

      // Interés mensual vs anual (compuesto)
      const monthlyRate = state.annualRate/12;
      const m = state.accounts.remunerated * monthlyRate;
      const a = state.accounts.remunerated * (Math.pow(1+monthlyRate,12)-1);
      const mode = state.interestMode;
      $('#interest-mode-label').textContent = mode==='monthly'? 'Mensual' : 'Anual (compuesto)';
      $('#kpi-interest').textContent = fmtEUR.format(mode==='monthly' ? m : a);

      // Fecha por defecto
      $('#tx-date').value = todayISO();

      // Tabla movimientos
      const tbody = $('#tx-table tbody');
      if(tbody){
        tbody.innerHTML = '';
        state.transactions.forEach(tx=>{
          const tr=document.createElement('tr');
          const d=tx.date ? new Date(tx.date) : null;
          tr.innerHTML = `
            <td>${d? d.toISOString().slice(0,10): ''}</td>
            <td style="text-transform:capitalize">${tx.type||tx.from? (tx.type||'transfer') : ''}${tx.planned?' (plan.)':''}</td>
            <td>${(tx.account||tx.from||'')==='remunerated'? 'Remunerada':'Corriente'}</td>
            <td>${fmtEUR.format(Number(tx.amount||0))}</td>
            <td>${tx.note|| (tx.from? `Transf. ${tx.from}→${tx.to}`:'') }</td>`;
          tbody.appendChild(tr);
        })
      }

      // Proyección
      const proj = buildProjection(state.horizon);
      drawChart(proj);
      renderProjectionTable(proj);
      $('#horizon').value = state.horizon; $('#horizon-label').textContent = String(state.horizon);
    }

    function renderProjectionTable(proj){
      const tb = $('#proj-table tbody'); if(!tb) return; tb.innerHTML='';
      proj.rows.forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td>${r.label}</td><td>${fmtEUR.format(r.start)}</td><td>${fmtEUR.format(r.interest)}</td><td>${fmtEUR.format(r.incomes)}</td><td>${fmtEUR.format(r.expenses)}</td><td>${fmtEUR.format(r.end)}</td>`;
        tb.appendChild(tr);
      })
    }

    function monthLabel(date){ return date.toLocaleDateString('es-ES',{month:'short', year:'2-digit'}) }

    function buildProjection(months){
      const monthlyRate = state.annualRate/12; let bal = state.accounts.remunerated;
      const labels=[], data=[], rows=[]; const now=new Date();
      const planned = state.transactions.filter(t=> t.planned && t.date && new Date(t.date)>now);
      const plansByYM = new Map();
      for(const t of planned){
        if(t.account!=="remunerated") continue;
        const d=new Date(t.date); const key=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
        if(!plansByYM.has(key)) plansByYM.set(key,{income:0, expense:0});
        if(t.type==='income') plansByYM.get(key).income += Number(t.amount||0);
        if(t.type==='expense') plansByYM.get(key).expense += Number(t.amount||0);
      }
      const start=new Date(); start.setDate(1);
      for(let i=1;i<=months;i++){
        const d=new Date(start); d.setMonth(d.getMonth()+i);
        const key=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
        const plan=plansByYM.get(key)||{income:0, expense:0};
        const startBal=bal; const base=startBal + plan.income - plan.expense; const interest=base*monthlyRate; const endBal=base+interest; bal=endBal;
        labels.push(monthLabel(d)); data.push(endBal);
        rows.push({label:labels.at(-1), start:startBal, incomes:plan.income, expenses:plan.expense, interest, end:endBal});
      }
      return {labels, data, rows};
    }

    function drawChart(proj){
      const ctx=$('#chart'); if(!ctx) return; if(state.chart) state.chart.destroy();
      state.chart = new Chart(ctx, {
        type:'line', data:{ labels:proj.labels, datasets:[{ label:'Saldo proyectado (Rem.)', data:proj.data, borderWidth:2, tension:.25, pointRadius:2 }]},
        options:{ responsive:true, plugins:{ legend:{display:false}, tooltip:{ callbacks:{ label:(c)=> fmtEUR.format(c.parsed.y) } } }, scales:{ y:{ ticks:{ callback:v=> fmtEUR.format(v) } } } }
      })
    }

    // ===== Acciones =====
    async function setBalance(account, value){
      const v=Number(value); if(!isFinite(v)) return; state.accounts[account]=v;
      await storage.set(account==='checking'? paths.accChecking: paths.accRem, {balance:v, updatedAt:Date.now()});
      renderAll();
    }

    async function saveRate(){
      const v = Number($('#rate').value)/100; if(!(v>=0)) return; state.annualRate=v; await storage.set(paths.settings,{annualRate:v, updatedAt:Date.now()}); renderAll();
    }

    async function doTransfer(){
      const from=$('#t-from').value, to=$('#t-to').value, amount=Number($('#t-amount').value);
      if(from===to) return alert('Elige cuentas distintas');
      if(!(amount>0)) return alert('Importe inválido');
      if(state.accounts[from] < amount) return alert('Saldo insuficiente');
      state.accounts[from]-=amount; state.accounts[to]+=amount;
      await storage.set(from==='checking'? paths.accChecking: paths.accRem, {balance: state.accounts[from], updatedAt:Date.now()});
      await storage.set(to==='checking'? paths.accChecking: paths.accRem, {balance: state.accounts[to], updatedAt:Date.now()});
      await storage.add(paths.txCol, {date:Date.now(), type:'transfer', amount, from, to, note:`Transferencia ${from}→${to}`});
      state.transactions = await storage.list(paths.txCol, {limit:200, orderBy:'date'});
      $('#t-amount').value=''; renderAll();
    }

    async function addMonthlyInterest(){
      const monthlyRate = state.annualRate/12; const amount= state.accounts.remunerated * monthlyRate; if(amount<=0) return;
      state.accounts.remunerated += amount;
      await storage.set(paths.accRem,{balance:state.accounts.remunerated, updatedAt:Date.now()});
      await storage.add(paths.txCol,{date:Date.now(), type:'interest', amount, account:'remunerated', note:'Interés mensual abonado'});
      state.transactions = await storage.list(paths.txCol, {limit:200, orderBy:'date'});
      renderAll();
    }

    async function addTx(){
      const date=$('#tx-date').value || todayISO();
      const type=$('#tx-type').value, account=$('#tx-account').value, amount=Number($('#tx-amount').value), note=$('#tx-note').value?.trim(), planned=$('#tx-planned').value==='true';
      if(!(amount>0)) return alert('Importe inválido');
      await storage.add(paths.txCol,{date:new Date(date).getTime(), type, account, amount, note, planned});
      if(!planned){ if(type==='income') state.accounts[account]+=amount; if(type==='expense') state.accounts[account]-=amount; await storage.set(account==='checking'? paths.accChecking: paths.accRem, {balance:state.accounts[account], updatedAt:Date.now()}); }
      state.transactions = await storage.list(paths.txCol, {limit:200, orderBy:'date'});
      $('#tx-amount').value=''; $('#tx-note').value=''; renderAll();
    }

    function exportJSON(){
      const blob=new Blob([JSON.stringify({settings:{annualRate:state.annualRate, horizon:state.horizon}, accounts:state.accounts, transactions:state.transactions}, null, 2)], {type:'application/json'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='mi_dinero_backup.json'; a.click(); URL.revokeObjectURL(url);
    }
    async function importJSON(){
      const inp=document.createElement('input'); inp.type='file'; inp.accept='.json,application/json';
      inp.onchange=async()=>{ const file=inp.files[0]; if(!file) return; const text=await file.text(); try{ const data=JSON.parse(text);
        if(data.settings){ state.annualRate=Number(data.settings.annualRate)||state.annualRate; state.horizon=Number(data.settings.horizon)||state.horizon; }
        if(data.accounts){ state.accounts={...state.accounts, ...data.accounts}; }
        await storage.set(paths.settings,{annualRate:state.annualRate, horizon:state.horizon, updatedAt:Date.now()});
        await storage.set(paths.accChecking,{balance:state.accounts.checking, updatedAt:Date.now()});
        await storage.set(paths.accRem,{balance:state.accounts.remunerated, updatedAt:Date.now()});
        if(Array.isArray(data.transactions)){ for(const tx of data.transactions){ await storage.add(paths.txCol, tx); } }
        state.transactions = await storage.list(paths.txCol, {limit:200, orderBy:'date'});
        renderAll();
      }catch(e){ alert('Archivo inválido'); } };
      inp.click();
    }

    // ===== Navegación =====
    function show(view){
      $$('.view').forEach(v=> v.classList.remove('active'));
      $('#view-'+view).classList.add('active');
      $$('.nav-btn').forEach(b=> b.classList.toggle('active', b.dataset.view===view));
      window.scrollTo({top:0, behavior:'instant'});
    }

    // ===== Eventos =====
    document.addEventListener('DOMContentLoaded', ()=>{
      // Nav
      $$('.nav-btn').forEach(b=> b.addEventListener('click', ()=> show(b.dataset.view)));
      $('#go-movements')?.addEventListener('click', ()=> show('movements'));
      $('#go-transfer')?.addEventListener('click', ()=> show('transfer'));

      // Saldos y tasa
      $('#cc-apply').addEventListener('click', ()=> setBalance('checking', $('#cc-edit').value));
      $('#rem-apply').addEventListener('click', ()=> setBalance('remunerated', $('#rem-edit').value));
      $('#save-rate').addEventListener('click', saveRate);

      // Interés
      $('#add-monthly-interest').addEventListener('click', addMonthlyInterest);
      $('#interest-card').addEventListener('click', ()=>{ state.interestMode = state.interestMode==='monthly' ? 'annual' : 'monthly'; renderAll(); });

      // Movimientos y transferencias
      $('#tx-add').addEventListener('click', addTx);
      $('#t-do').addEventListener('click', doTransfer);

      // Export/Import
      $('#btn-export').addEventListener('click', exportJSON);
      $('#btn-import').addEventListener('click', importJSON);

      // Horizonte
      $('#horizon').addEventListener('input', e=> { state.horizon = Number(e.target.value); $('#horizon-label').textContent = String(state.horizon); renderAll(); });

      loadAll();
    });
  </script>
</body>
</html>
