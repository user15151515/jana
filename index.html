<!DOCTYPE html>
<html lang="ca" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestor de diners</title>

  <!-- === Fonts & CSS === -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">

  <!-- === Charts === -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
</head>
<body>
  <!-- === SVG Sprites (icones) === -->
  <svg aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden">
    <symbol id="icon-sun" viewBox="0 0 24 24">
      <path d="M12 4V2m0 20v-2m8-8h2M2 12h2m13.657-6.343 1.414-1.414M4.929 19.071l1.414-1.414m0-10.314L4.93 4.93M19.071 19.071l-1.414-1.414M12 8a4 4 0 1 1 0 8a4 4 0 0 1 0-8Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
    </symbol>
    <symbol id="icon-moon" viewBox="0 0 24 24">
      <path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
    </symbol>
    <symbol id="icon-edit" viewBox="0 0 24 24">
      <path d="M3 21l3.75-.75L19 8.99a1.5 1.5 0 0 0 0-2.12l-1.86-1.86a1.5 1.5 0 0 0-2.12 0L2.75 16.25 2 20.99 3 21Z" fill="currentColor"/>
    </symbol>
 <symbol id="icon-trash" viewBox="0 0 24 24">
    <path d="M4 7h16M9 7V5h6v2m-1 0v11a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2V7" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>

  <div class="container">
    <!-- === Header === -->
    <header class="header">
      <div class="brand">
        <div class="logo" aria-hidden></div>
        <div>
          <h1>Gestor de diners</h1>
        </div>
      </div>

      <!-- Botó tema amb icones -->
      <button id="themeToggle" class="btn alt icon-btn" aria-label="Canvia tema" title="Canvia tema">
        <svg class="icon sun"><use href="#icon-sun"></use></svg>
        <svg class="icon moon"><use href="#icon-moon"></use></svg>
        <span class="sr-only">Canvia tema</span>
      </button>
    </header>

    <!-- === Grid principal === -->
    <div class="grid">
      <!-- === Card Formulari === -->
      <section class="card">
        <div class="head"><div class="title">Afegir mes</div></div>
        <div class="body">
          <form id="entryForm" class="form">
            <div class="row">
              <div class="field">
                <label for="month">Mes</label>
                <input id="month" type="month" class="input" required />
              </div>
              <div class="field">
                <label for="income">Ingressos (€)</label>
                <input id="income" type="number" step="0.01" min="0" class="input" placeholder="0,00" required />
              </div>
              <div class="field">
                <label for="expenses">Despeses (€)</label>
                <input id="expenses" type="number" step="0.01" min="0" class="input" placeholder="0,00" required />
              </div>
            </div>
            <div class="row">
              <div class="field">
                <label for="ending">Saldo final (€) — opcional</label>
                <input id="ending" type="number" step="0.01" class="input" placeholder="p.ex. 3.250" />
              </div>
              <div class="field" style="flex:1 1 100%">
                <label for="notes">Notes</label>
                <input id="notes" type="text" class="input" placeholder="Bonus, vacances, imprevistos…" />
              </div>
            </div>
            <div class="form-actions">
              <button type="reset" class="btn alt">Neteja</button>
              <button type="submit" class="btn">Guarda</button>
            </div>
          </form>
        </div>
      </section>

      <!-- === Card Resum/KPIs/Gràfics === -->
      <section class="card">
        <div class="head">
          <div class="title">Resum</div>
          <span id="periodSpan" class="pill">—</span>
        </div>
        <div class="body">
          <div class="kpis">
            <div class="kpi" id="kpiBalance"><h3>Balanç acumulat</h3><div class="value">—</div></div>
            <div class="kpi" id="kpiLast"><h3>Balanç de l’últim mes</h3><div class="value">—</div></div>
          </div>

          <div class="charts">
            <div class="card flat">
              <div class="head"><div class="title">Evolució del saldo final</div></div>
              <div class="body"><canvas id="saldoChart" height="140"></canvas></div>
            </div>
            <div class="card flat">
              <div class="head"><div class="title">Balanç mensual</div></div>
              <div class="body"><canvas id="lineChart" height="140"></canvas></div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- === Card Taula historial === -->
    <section class="card" style="margin-top:18px">
      <div class="head"><div class="title">Històric mensual</div></div>
      <div class="body">
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Mes</th>
                <th>Ingressos</th>
                <th>Despeses</th>
                <th>Balanç</th>
                <th>Saldo final</th>
                <th>Notes</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <!-- === Toast === -->
  <div class="toast" id="toast">Dades guardades</div>

  <!-- === Firebase compat (app + firestore) === -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
  <script>
    // === Firebase Config ===
    const firebaseConfig = {
      apiKey: "AIzaSyDv2Egv82HhG0WT5iXTMKdQQrFOzxx4REk",
      authDomain: "jana-eb892.firebaseapp.com",
      projectId: "jana-eb892",
      storageBucket: "jana-eb892.firebasestorage.app",
      messagingSenderId: "64652708371",
      appId: "1:64652708371:web:30eb4b4e44bba82ac8cde6",
      measurementId: "G-MFFZ0FJ87W"
    };

    // === Firebase Init ===
    firebase.initializeApp(firebaseConfig);

    // === Firestore + opcional persistència ===
    try { firebase.firestore().enablePersistence({ synchronizeTabs: true }); }
    catch(e){ console.warn('Persistence no disponible:', e.message); }

    // Exposa Firestore
    window.db = firebase.firestore();
  </script>

  <!-- === App === -->
  <script src="./app.js"></script>
</body>
</html>
